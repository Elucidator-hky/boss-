# BOSS直聘浏览器助手功能文档

## 阶段1：聊天页静态问题自动回复

### 问题：

HR 经常不看个人信息页，重复询问基础信息（如当前城市、离职状态、学历等），导致高频重复沟通。

### 解决过程

1.构建个人信息（首次使用时构建，后续可以增加）

2.读取当前聊天内容

![image-20251217115616999](C:\Users\19502\Desktop\image-20251217115616999.png)

3.填充当前聊天框

### 功能实现

#### 技术选择
- 浏览器扩展：Chrome/Edge Manifest V3
- 模块划分
  - Content Script：运行在 `/web/geek/chat`，负责读取会话消息、定位输入框、填充草稿
  - Background(Service Worker)：负责调用远程大模型 API（跨域 fetch、重试、限流）
  - Options 配置页：维护个人信息（必填校验、导入导出）
- 本地存储
  - `chrome.storage.local`：个人信息配置、白名单配置、会话草稿索引
  -（可选后续）`IndexedDB`：存 JD 摘要、长会话摘要、历史缓存

#### 配置个人信息（必填项）
- 必填字段（阶段1）
  - 当前城市
  - 离职状态
  - 工作年限
  - 学历
  - 求职方向
  - 技术栈关键词
  
  - 离职前薪资
  - 离职时间
  - 离职原因口径
  - 项目亮点要点
  
- 配置规则
  - 首次使用必须完成必填项，否则不触发自动生成
  - 支持版本号与字段扩展（schema_version）
  -（补充功能）上传简历解析配置：不做在阶段1

#### 当前会话信息获取
- 会话标识 `conversationKey`（用于“防串会话/防误填”）
  - 优先：从 URL / 会话列表项的链接参数提取唯一标识
  - 备用：从当前选中的会话 DOM 节点取稳定属性（如 data-id）
  - 再备用：用“HR昵称 + 公司名 + 会话入口链接”拼一个稳定 key
- 消息抽取
  - 读取当前页面已加载的消息（或最近 N 条，例如 20 条）
  - 结构化为：`[{role: "hr"|"me", text: "..."}]`
- 触发时机
  - 监听消息列表新增（新 HR 消息出现才触发一次）
  - 同一条 HR 消息只处理一次（幂等）

#### 调用远程大模型 API
- 请求内容（最小集）
  - `profile_static`：个人静态信息
  - `conversationKey`：会话标识
  - `messages`：最近 N 条对话
  - `rules`：要求“按我的基本信息回答、简洁准确；无法准确回答输出：我无法回答”
- 返回内容（结构化）
  - `conversationKey`
  - `reply`：建议回复文本
  - `can_answer`：true/false
  - `missing_fields`：缺失的个人信息字段列表
- 失败处理
  - 超时/报错时不填充，只提示“生成失败”
  - 简单重试（1 次）即可，避免卡死

#### 填充当前会话框（处理切换会话）
- 填充前校验（必须做）
  - 生成时的 `conversationKey` == 当前页面的 `conversationKey`，否则禁止填充
  - 输入框为空才自动填充；非空则不覆盖（仅提示“已有输入”）
- 如果用户切换到其他会话怎么办
  - 不在新会话里填充
  - 将草稿保存到 `drafts[conversationKey]`
  - 给提示：该草稿已保存，回到对应会话可“一键填充”
- 填充动作
  - 设置输入框内容 + 触发 input 事件
  - 不自动发送（用户自行发送）

## 阶段2：聊天页绑定JD后的意向判断与回复
## 阶段3：岗位浏览与初筛（带JD上下文进入聊天）

## 阶段1开发计划（半页版）

- 范围：仅做聊天页静态问题自动回复；不做自动发送、JD 解析、岗位筛选。
- 产出：MV3 扩展（content script + background + options），支持个人信息配置、消息抽取、模型调用、草稿填充、草稿保存与提示。
- 依赖/接口：
  - 模型 API：HTTP POST（OpenAI 兼容优先），输入 `{profile_static, conversationKey, messages}`，输出 `{conversationKey, reply, can_answer, missing_fields}`；超时 8-10s，失败重试 1 次。
  - 存储：`chrome.storage.local`，键：`profile_static`（含 schema_version）、`drafts`、`whitelist`、`settings`（开关/阈值）。
- 模块与任务：
  1) Options 配置页：表单校验（必填：城市/离职状态/年限/学历/方向/技术栈），JSON 导入导出，版本号校验。
  2) Content Script：挂载 `/web/geek/chat`，提取 conversationKey、最近 N 条消息（含角色），监听新 HR 消息触发生成；输入框状态检测、草稿填充（仅空时填）、切会话草稿保存与“一键填充”提示。
  3) Background(Service Worker)：模型请求封装（鉴权 header、超时、重试、速率限制），错误提示与缺字段提示。
  4) 风控与体验：全局节流（如每 5s 至少间隔），同一 HR 消息只触发一次；默认半自动（不自动发送），显式 toast/提示。
  5) 工具与构建：打包/发布脚本（zip），开发模式热加载说明。
- 测试要点：无配置不触发；缺字段时提示；切换会话不误填；输入框有内容不覆盖；生成失败提示可见；长对话截断后仍能生成。
- 时间预估：3-4 人日（内容脚本 1d，背景 0.5d，配置页 0.5-1d，填充/草稿 0.5d，测试/打包 0.5d）。
